(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     69113,       1836]
NotebookOptionsPosition[     65676,       1773]
NotebookOutlinePosition[     66111,       1790]
CellTagsIndexPosition[     66068,       1787]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Flow and Exact Diagonalisation", "Title",
 CellChangeTimes->{{3.8642666281836863`*^9, 
  3.864266640830039*^9}},ExpressionUUID->"310d66e1-51a3-4a2e-a121-\
19f035776462"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], ";", 
   RowBox[{"$HistoryLength", "=", "2"}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LSpecificDefinitions", ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "SigmaPlus", ",", "SigmaMin", ",", "nOp", ",", "Id", ",", "FSId", ",", 
        "AllId", ",", "nOperators", ",", "nSums", ",", "PhaseFactors", ",", 
        "AllBasisStates", ",", "BasisStateOccupations"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SigmaPlus", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], ";", 
       RowBox[{"SigmaMin", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}], "}"}], "]"}]}], ";", 
       RowBox[{"nOp", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}], "]"}]}], ";", 
       RowBox[{"Id", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"FSId", "=", 
        RowBox[{"IdentityMatrix", "[", 
         RowBox[{
          RowBox[{"2", "^", "L"}], ",", "SparseArray"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AllId", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"Id", ",", 
          RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nOperators", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"KroneckerProduct", " ", "@@", " ", 
            RowBox[{"(", 
             RowBox[{"ReplacePart", "[", 
              RowBox[{"AllId", ",", 
               RowBox[{"#", "\[Rule]", "nOp"}]}], "]"}], ")"}]}], ")"}], 
          "&"}], " ", "/@", " ", 
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", "L"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nSums", "=", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"Most", "[", 
           RowBox[{"Accumulate", "[", "nOperators", "]"}], "]"}], ",", 
          RowBox[{"0", " ", "FSId"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"PhaseFactors", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MatrixExp", "[", 
            RowBox[{"I", " ", "\[Pi]", " ", "#"}], "]"}], "&"}], " ", "/@", 
          " ", "nSums"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AllBasisStates", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"IntegerDigits", "[", 
           RowBox[{"#", ",", "2", ",", "L"}], "]"}], "&"}], " ", "/@", " ", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{"2", "^", "L"}], "-", "1"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"BasisStateOccupations", "=", 
        RowBox[{"Total", " ", "/@", " ", "AllBasisStates"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ClearAll", "[", 
        RowBox[{"c", ",", "cd"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{"Array", "[", 
          RowBox[{"cd", ",", "L"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"PhaseFactors", "[", 
             RowBox[{"[", "#", "]"}], "]"}], ".", 
            RowBox[{"(", 
             RowBox[{"KroneckerProduct", " ", "@@", " ", 
              RowBox[{"(", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"AllId", ",", 
                 RowBox[{"#", "\[Rule]", "SigmaPlus"}]}], "]"}], ")"}]}], 
             ")"}]}], ")"}], "&"}], " ", "/@", " ", 
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", "L"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{"Array", "[", 
          RowBox[{"c", ",", "L"}], "]"}], "]"}], "=", 
        RowBox[{"Transpose", " ", "/@", " ", 
         RowBox[{"Array", "[", 
          RowBox[{"cd", ",", "L"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"BasisStateIndices", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"BasisStateOccupations", ",", "#"}], "]"}], "]"}], "&"}], 
         " ", "/@", " ", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "L"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DiagonalTensorMask", "[", "2", "]"}], "=", 
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "L", "]"}], "//", "N"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DiagonalTensorMask", "[", "4", "]"}], "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"KroneckerDelta", "[", 
              RowBox[{"i", ",", "k"}], "]"}], 
             RowBox[{"KroneckerDelta", "[", 
              RowBox[{"j", ",", "l"}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"KroneckerDelta", "[", 
              RowBox[{"i", ",", "l"}], "]"}], 
             RowBox[{"KroneckerDelta", "[", 
              RowBox[{"j", ",", "k"}], "]"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "L"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "L"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", "1", ",", "L"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"l", ",", "1", ",", "L"}], "}"}]}], "]"}], "//", "N"}]}], 
       ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConstructOperator", "[", 
    RowBox[{"AA_", "/;", 
     RowBox[{
      RowBox[{"ArrayDepth", "[", "AA", "]"}], "\[Equal]", "2"}]}], "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"AA", "[", 
       RowBox[{"[", 
        RowBox[{"i", ",", "j"}], "]"}], "]"}], 
      RowBox[{
       RowBox[{"cd", "[", "i", "]"}], ".", 
       RowBox[{"c", "[", "j", "]"}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "L"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "L"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConstructOperator", "[", 
    RowBox[{"AA_", "/;", 
     RowBox[{
      RowBox[{"ArrayDepth", "[", "AA", "]"}], "\[Equal]", "4"}]}], "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"AA", "[", 
       RowBox[{"[", 
        RowBox[{"i", ",", "j", ",", "k", ",", "l"}], "]"}], "]"}], 
      RowBox[{
       RowBox[{"cd", "[", "i", "]"}], ".", 
       RowBox[{"cd", "[", "j", "]"}], ".", 
       RowBox[{"c", "[", "k", "]"}], ".", 
       RowBox[{"c", "[", "l", "]"}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "L"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "L"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", "L"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"l", ",", "1", ",", "L"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConstructOperator", "[", 
     RowBox[{"AA_", ",", "BB_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"ConstructOperator", "[", "AA", "]"}], "+", 
     RowBox[{"ConstructOperator", "[", "BB", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SymmetriseTensor", "[", 
    RowBox[{"AA_", "/;", 
     RowBox[{
      RowBox[{"ArrayDepth", "[", "AA", "]"}], "\[Equal]", "4"}]}], "]"}], ":=", 
   RowBox[{"Symmetrize", "[", 
    RowBox[{"AA", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4"}], "}"}], "}"}], "]"}], ",", 
         RowBox[{"-", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}], "}"}], "]"}], ",", 
         RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SymmetriseTensorOwn", "[", "A_", "]"}], ":=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"A", "-", 
       RowBox[{"Transpose", "[", 
        RowBox[{"A", ",", 
         RowBox[{"1", "\[TwoWayRule]", "2"}]}], "]"}], "-", 
       RowBox[{"Transpose", "[", 
        RowBox[{"A", ",", 
         RowBox[{"3", "\[TwoWayRule]", "4"}]}], "]"}], "+", 
       RowBox[{"Transpose", "[", 
        RowBox[{"A", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1", ",", "4", ",", "3"}], "}"}]}], "]"}]}], 
      ")"}], "/", "4"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomTensor", "[", "2", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"#", "+", 
       RowBox[{"ConjugateTranspose", "[", "#", "]"}]}], ")"}], "&"}], "@", 
    RowBox[{"RandomReal", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"L", ",", "L"}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomTensor", "[", "4", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"#", "+", 
       RowBox[{"Conjugate", "[", 
        RowBox[{"Transpose", "[", 
         RowBox[{"#", ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "3", ",", "2", ",", "1"}], "}"}]}], "]"}], 
        "]"}]}], ")"}], "&"}], "@", 
    RowBox[{"SymmetriseTensor", "[", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"L", ",", "L", ",", "L", ",", "L"}], "}"}]}], "]"}], 
     "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomOperator", "[", "2", "]"}], ":=", 
   RowBox[{"ConstructOperator", "[", 
    RowBox[{"RandomTensor", "[", "2", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomOperator", "[", "4", "]"}], ":=", 
    RowBox[{"ConstructOperator", "[", 
     RowBox[{"RandomTensor", "[", "4", "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OperatorTrace", "[", "A_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Tr", "[", "A", "]"}], "/", 
     RowBox[{"2", "^", "L"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TensorTrace", "[", "A_", "]"}], ":=", 
   RowBox[{"OperatorTrace", "[", 
    RowBox[{"ConstructOperator", "[", "A", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TensorTrace", "[", 
    RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
   RowBox[{"OperatorTrace", "[", 
    RowBox[{"ConstructOperator", "[", 
     RowBox[{"A", ",", "B"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TensorTrace2", "[", "A_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"OperatorTrace", "[", 
       RowBox[{"#", ".", "#"}], "]"}], "-", 
      RowBox[{
       RowBox[{"OperatorTrace", "[", "#", "]"}], "^", "2"}]}], "&"}], " ", 
    "@", " ", 
    RowBox[{"ConstructOperator", "[", "A", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TensorTrace2", "[", 
     RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"OperatorTrace", "[", 
        RowBox[{"#", ".", "#"}], "]"}], "-", 
       RowBox[{
        RowBox[{"OperatorTrace", "[", "#", "]"}], "^", "2"}]}], "&"}], " ", 
     "@", " ", 
     RowBox[{"ConstructOperator", "[", 
      RowBox[{"A", ",", "B"}], "]"}]}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TensorTraceExpression", "[", 
    RowBox[{"A_", ",", "B_", ",", 
     RowBox[{"n_", ":", "0.5"}]}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"b", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"B", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j", ",", "i", ",", "j"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "L"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "L"}], "}"}]}], "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"n", " ", 
       RowBox[{"Tr", "[", "A", "]"}]}], "-", 
      RowBox[{"2", " ", 
       RowBox[{"n", "^", "2"}], " ", 
       RowBox[{"Total", "[", 
        RowBox[{"b", ",", "2"}], "]"}]}]}]}], "]"}]}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TensorTrace2Expression", "[", 
     RowBox[{"A_", ",", "B_", ",", 
      RowBox[{"n_", ":", "0.5"}]}], "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"b", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"B", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j", ",", "i", ",", "j"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "L"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "L"}], "}"}]}], "]"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"q", "^", "2"}], " ", "n", 
        RowBox[{"(", 
         RowBox[{"1", "-", "n"}], ")"}], " ", 
        RowBox[{"Tr", "[", 
         RowBox[{"A", ".", "A"}], "]"}]}], "-", 
       RowBox[{
        RowBox[{"q", "^", "3"}], " ", "8", 
        RowBox[{"n", "^", "2"}], 
        RowBox[{"(", 
         RowBox[{"1", "-", "n"}], ")"}], 
        RowBox[{"Total", "[", 
         RowBox[{"b", ".", 
          RowBox[{"Diagonal", "[", "A", "]"}]}], "]"}]}], "+", " ", 
       RowBox[{
        RowBox[{"q", "^", "4"}], " ", "16", " ", 
        RowBox[{"n", "^", "3"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "-", "n"}], ")"}], " ", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{"b", ".", "b"}], ",", "2"}], "]"}]}], "+", " ", 
       RowBox[{
        RowBox[{"q", "^", "5"}], " ", "8", " ", 
        RowBox[{"n", "^", "2"}], " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "n"}], ")"}], "^", "2"}], " ", 
        RowBox[{"Tr", "[", 
         RowBox[{"b", ".", "b"}], "]"}]}]}]}], "]"}]}], " ", ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TensorAdjoint", "[", "xx_", "]"}], ":=", 
   RowBox[{"Conjugate", "[", 
    RowBox[{"Transpose", "[", 
     RowBox[{"xx", ",", 
      RowBox[{"Reverse", "[", 
       RowBox[{"Range", "[", 
        RowBox[{"1", ",", 
         RowBox[{"ArrayDepth", "[", "xx", "]"}]}], "]"}], "]"}]}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TensorHermitianQ", "[", "xx_", "]"}], ":=", 
    RowBox[{"Max", "[", 
     RowBox[{"Abs", "[", 
      RowBox[{"xx", "-", 
       RowBox[{"TensorAdjoint", "[", "xx", "]"}]}], "]"}], "]"}]}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TensorAntiHermitianQ", "[", "xx_", "]"}], ":=", 
   RowBox[{"Max", "[", 
    RowBox[{"Abs", "[", 
     RowBox[{"xx", "+", 
      RowBox[{"TensorAdjoint", "[", "xx", "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TensorOffDiagonality", "[", 
    RowBox[{"AA_", "/;", 
     RowBox[{
      RowBox[{"ArrayDepth", "[", "AA", "]"}], "\[Equal]", "2"}]}], "]"}], ":=", 
   RowBox[{"Max", "[", 
    RowBox[{"Abs", "[", 
     RowBox[{"AA", "-", 
      RowBox[{
       RowBox[{"DiagonalTensorMask", "[", "2", "]"}], " ", "AA"}]}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TensorOffDiagonality", "[", 
    RowBox[{"AA_", "/;", 
     RowBox[{
      RowBox[{"ArrayDepth", "[", "AA", "]"}], "\[Equal]", "4"}]}], "]"}], ":=", 
   RowBox[{"Max", "[", 
    RowBox[{"Abs", "[", 
     RowBox[{"AA", "-", 
      RowBox[{
       RowBox[{"DiagonalTensorMask", "[", "4", "]"}], " ", "AA"}]}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TensorOffDiagonality", "[", 
     RowBox[{"AA_", ",", "BB_"}], "]"}], ":=", 
    RowBox[{"TensorOffDiagonality", "/@", " ", 
     RowBox[{"{", 
      RowBox[{"AA", ",", "BB"}], "}"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Commutator", "[", 
    RowBox[{"A1_", ",", "B1_", ",", "A2_", ",", "B2_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"A1", ".", "A2"}], "-", 
      RowBox[{"A2", ".", "A1"}]}], ",", 
     RowBox[{
      RowBox[{"2", 
       RowBox[{"SymmetriseTensorOwn", "[", 
        RowBox[{
         RowBox[{"A1", ".", "B2"}], "-", 
         RowBox[{"B2", ".", "A1"}], "+", 
         RowBox[{"B1", ".", "A2"}], "-", 
         RowBox[{"A2", ".", "B1"}]}], "]"}]}], "+", 
      RowBox[{"2", 
       RowBox[{"TensorContract", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"B1", ".", "B2"}], "-", 
          RowBox[{"B2", ".", "B1"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4"}], "}"}], "}"}]}], "]"}]}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Commutator4", "[", 
    RowBox[{"A1_", ",", "B1_", ",", "A2_", ",", "B2_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"2", 
     RowBox[{"SymmetriseTensorOwn", "[", 
      RowBox[{
       RowBox[{"A1", ".", "B2"}], "-", 
       RowBox[{"B2", ".", "A1"}], "+", 
       RowBox[{"B1", ".", "A2"}], "-", 
       RowBox[{"A2", ".", "B1"}]}], "]"}]}], "+", 
    RowBox[{"2", 
     RowBox[{"TensorContract", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"B1", ".", "B2"}], "-", 
        RowBox[{"B2", ".", "B1"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"3", ",", "4"}], "}"}], "}"}]}], "]"}]}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dH2", "[", 
    RowBox[{"A_", "?", "MatrixQ"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"A0", ",", "eta2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"A0", "=", 
       RowBox[{
        RowBox[{"DiagonalTensorMask", "[", "2", "]"}], " ", "A"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"eta2", "=", 
       RowBox[{
        RowBox[{"A0", ".", "A"}], "-", 
        RowBox[{"A", ".", "A0"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"eta2", ".", "A"}], "-", 
       RowBox[{"A", ".", "eta2"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"dH4", "[", 
     RowBox[{
      RowBox[{"A_", "?", "MatrixQ"}], ",", "B_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"A0", ",", "B0", ",", "eta2", ",", "eta4"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"A0", "=", 
        RowBox[{
         RowBox[{"DiagonalTensorMask", "[", "2", "]"}], " ", "A"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"B0", "=", 
        RowBox[{
         RowBox[{"DiagonalTensorMask", "[", "4", "]"}], " ", "B"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"eta2", ",", "eta4"}], "}"}], "=", 
        RowBox[{"Commutator", "[", 
         RowBox[{"A0", ",", "B0", ",", "A", ",", "B"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Commutator4", "[", 
        RowBox[{"eta2", ",", "eta4", ",", "A", ",", "B"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"EigenvaluesPerSector", "[", 
     RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Matrix", ",", "SubMatrices"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Matrix", "=", 
        RowBox[{"ConstructOperator", "[", 
         RowBox[{"A", ",", "B"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"SubMatrices", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Matrix", "[", 
           RowBox[{"[", 
            RowBox[{"#", ",", "#"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
         "BasisStateIndices"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Sort", " ", "/@", " ", 
        RowBox[{"Eigenvalues", " ", "/@", " ", "SubMatrices"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EigenvectorsPerSector", "[", 
    RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Matrix", ",", "SubMatrices"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Matrix", "=", 
       RowBox[{"ConstructOperator", "[", 
        RowBox[{"A", ",", "B"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"SubMatrices", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Matrix", "[", 
          RowBox[{"[", 
           RowBox[{"#", ",", "#"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
        "BasisStateIndices"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Eigenvectors", " ", "/@", " ", "SubMatrices"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PTEigenvaluesPerSector", "[", 
     RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "Matrix", ",", "SubMatrices", ",", "Matrix0", ",", "SubMatrices0", ",",
         "ev0"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Matrix0", "=", 
        RowBox[{"ConstructOperator", "[", 
         RowBox[{"A", ",", 
          RowBox[{"0", " ", "B"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"SubMatrices0", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Matrix0", "[", 
           RowBox[{"[", 
            RowBox[{"#", ",", "#"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
         "BasisStateIndices"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ev0", "=", 
        RowBox[{"Eigenvectors", " ", "/@", " ", "SubMatrices0"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Matrix", "=", 
        RowBox[{"ConstructOperator", "[", 
         RowBox[{"A", ",", "B"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"SubMatrices", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Matrix", "[", 
           RowBox[{"[", 
            RowBox[{"#", ",", "#"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
         "BasisStateIndices"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Sort", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", ".", 
             RowBox[{"SubMatrices", "[", 
              RowBox[{"[", "ii", "]"}], "]"}], ".", "#"}], "&"}], " ", "/@", 
           " ", 
           RowBox[{"ev0", "[", 
            RowBox[{"[", "ii", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"ii", ",", "1", ",", 
           RowBox[{"L", "+", "1"}]}], "}"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PrependRow", "[", 
    RowBox[{"M_", ",", "R_"}], "]"}], ":=", 
   RowBox[{"Prepend", "[", 
    RowBox[{"M", ",", "R"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PrependColumn", "[", 
    RowBox[{"M_", ",", "CC_"}], "]"}], ":=", 
   RowBox[{"MapThread", "[", 
    RowBox[{"Prepend", ",", 
     RowBox[{"{", 
      RowBox[{"M", ",", "CC"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PrintSummary", "[", 
    RowBox[{"A0_", ",", "B0_", ",", "A_", ",", "B_"}], "]"}], ":=", 
   RowBox[{"Print", "[", 
    RowBox[{"Column", "[", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Off-diagonality: \>\"", ",", "Bold"}], "]"}], ",", 
          RowBox[{"TensorOffDiagonality", "[", 
           RowBox[{"A", ",", "B"}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{"\"\<2 Trace: \>\"", ",", "Bold"}], "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", 
              RowBox[{"100", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#2", "-", "#1"}], ")"}], "/", "#1"}]}]}], "}"}], 
            "&"}], "@@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"TensorTrace", "[", "A0", "]"}], ",", 
             RowBox[{"TensorTrace", "[", "A", "]"}]}], "}"}]}]}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{"\"\<4 Trace: \>\"", ",", "Bold"}], "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", 
              RowBox[{"100", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#2", "-", "#1"}], ")"}], "/", "#1"}]}]}], "}"}], 
            "&"}], "@@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"TensorTrace", "[", "B0", "]"}], ",", 
             RowBox[{"TensorTrace", "[", "B", "]"}]}], "}"}]}]}], "}"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{
           "\"\<\!\(\*SuperscriptBox[\(Trace\), \(2\)]\): \>\"", ",", 
            "Bold"}], "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", 
              RowBox[{"100", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#2", "-", "#1"}], ")"}], "/", "#1"}]}]}], "}"}], 
            "&"}], "@@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"TensorTrace2", "[", 
              RowBox[{"A0", ",", "B0"}], "]"}], ",", 
             RowBox[{"TensorTrace2", "[", 
              RowBox[{"A", ",", "B"}], "]"}]}], "}"}]}]}], "}"}], "]"}]}], 
      "\[IndentingNewLine]", "}"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PrintErrorTable", "[", 
    RowBox[{"EV1_", ",", "EV2_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "Errors", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Errors", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Mean", "[", "#", "]"}], ",", 
           RowBox[{"Max", "[", "#", "]"}]}], "}"}], "&"}], " ", "/@", " ", 
        RowBox[{"(", 
         RowBox[{"100", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"EV2", "-", "EV1"}], ")"}], "/", "EV1"}]}], ")"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Grid", "[", 
        RowBox[{"PrependRow", "[", 
         RowBox[{
          RowBox[{"PrependColumn", "[", 
           RowBox[{"Errors", ",", 
            RowBox[{"Range", "[", 
             RowBox[{"1", ",", "L"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<N\>\"", ",", "Bold"}], "]"}], ",", 
            RowBox[{"Style", "[", 
             RowBox[{"\"\<Mean % Error\>\"", ",", "Bold"}], "]"}], ",", 
            RowBox[{"Style", "[", 
             RowBox[{"\"\<Max % Error\>\"", ",", "Bold"}], "]"}]}], "}"}]}], 
         "]"}], "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PrintEigenvalueTable", "[", 
    RowBox[{"EV1_", ",", "title_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "table", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"table", "=", 
       RowBox[{"PrependColumn", "[", 
        RowBox[{"EV1", ",", 
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", "L"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"TableForm", "[", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{"\"\<N\>\"", ",", "Bold"}], "]"}], ",", 
           RowBox[{"Style", "[", 
            RowBox[{"title", ",", "Bold"}], "]"}]}], "}"}], "}"}], "]"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"TableForm", "[", "table", "]"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.862387499933401*^9, 3.8623875119828577`*^9}, 
   3.8623902472169065`*^9, 3.8623919897216377`*^9, {3.8623922061016307`*^9, 
   3.862392259105152*^9}, {3.8623925558837185`*^9, 3.8623925766137323`*^9}, {
   3.862392689611326*^9, 3.8623926994693046`*^9}, {3.862393010229248*^9, 
   3.8623930218290186`*^9}, 3.8623930722113886`*^9, 3.8623931472672887`*^9, {
   3.8623932240037737`*^9, 3.8623932267838755`*^9}, {3.862393685744422*^9, 
   3.8623937395938025`*^9}, {3.8623938809132547`*^9, 3.862393959431824*^9}, {
   3.862394019603259*^9, 3.8623940352627974`*^9}, {3.862394374316241*^9, 
   3.862394446955847*^9}, 3.8623949375815277`*^9, {3.862394992059763*^9, 
   3.8623950001141634`*^9}, {3.862396492771351*^9, 3.862396522378917*^9}, {
   3.86244719939362*^9, 3.862447209538184*^9}, {3.8624578642580895`*^9, 
   3.8624578647841682`*^9}, {3.862457921379383*^9, 3.862457922930579*^9}, {
   3.8624579607712555`*^9, 3.8624579674427295`*^9}, {3.862458967338003*^9, 
   3.8624590471547875`*^9}, {3.862459150820676*^9, 3.8624591936226482`*^9}, {
   3.8624592887443237`*^9, 3.8624593062947445`*^9}, {3.862459389351646*^9, 
   3.8624594731440215`*^9}, {3.8624596758039875`*^9, 3.862459784111787*^9}, {
   3.8624598870112877`*^9, 3.862459916109917*^9}, {3.8624600680246983`*^9, 
   3.862460074447873*^9}, {3.8624603440826902`*^9, 3.8624603629965315`*^9}, {
   3.8624604690588245`*^9, 3.8624604709035816`*^9}, 3.8624606377264423`*^9, {
   3.8624609291177397`*^9, 3.8624609558715696`*^9}, {3.862460993968813*^9, 
   3.8624609967659674`*^9}, {3.862461064124853*^9, 3.8624610776686335`*^9}, 
   3.8624611199825478`*^9, {3.862461789450616*^9, 3.8624618131510787`*^9}, {
   3.862462112224866*^9, 3.862462113646692*^9}, {3.8624624083133326`*^9, 
   3.8624624775392814`*^9}, {3.862462926663289*^9, 3.8624629616412697`*^9}, {
   3.8624631095079775`*^9, 3.8624634088239613`*^9}, {3.862463457227626*^9, 
   3.862463494789752*^9}, 3.8624641004788456`*^9, {3.862473617189041*^9, 
   3.8624736642389507`*^9}, {3.8624737691262035`*^9, 3.862473847438775*^9}, {
   3.862473906144638*^9, 3.862473984334222*^9}, {3.86247407471237*^9, 
   3.862474090324383*^9}, {3.86247432892113*^9, 3.862474353001711*^9}, {
   3.8624747769335985`*^9, 3.862474778339823*^9}, {3.8624760403468256`*^9, 
   3.8624760886507845`*^9}, {3.8624761389396305`*^9, 
   3.8624761393302116`*^9}, {3.8624766536251616`*^9, 
   3.8624766944448285`*^9}, {3.8624767587560945`*^9, 3.862476758818572*^9}, {
   3.8624782486200323`*^9, 3.862478255564541*^9}, {3.8624790580498643`*^9, 
   3.862479058252983*^9}, {3.862569030999795*^9, 3.8625690388758693`*^9}, 
   3.8625695151360593`*^9, {3.862569560724158*^9, 3.862569601768194*^9}, {
   3.8625697463374524`*^9, 3.8625697715797343`*^9}, {3.86256985563702*^9, 
   3.8625699924751835`*^9}, {3.862570207455996*^9, 3.8625702827666807`*^9}, {
   3.8625705393891335`*^9, 3.862570564509798*^9}, {3.8628850349591074`*^9, 
   3.862885037553214*^9}, {3.862885405021539*^9, 3.862885457099821*^9}, {
   3.8628858857813025`*^9, 3.862885888406537*^9}, 3.8628897117727814`*^9, {
   3.8628929601709404`*^9, 3.862892960239953*^9}, {3.862895159982293*^9, 
   3.8628951954044404`*^9}, 3.8628953560709033`*^9, {3.8640965628915176`*^9, 
   3.8640965810111694`*^9}, {3.864096660263582*^9, 3.864096719349893*^9}, {
   3.8640967522624545`*^9, 3.864096771717164*^9}, {3.8640968369912615`*^9, 
   3.8640968703161125`*^9}, {3.864096909642367*^9, 3.8640969098585653`*^9}, {
   3.864097753824428*^9, 3.8640979799635553`*^9}, {3.8640983352134376`*^9, 
   3.8640983362633553`*^9}, 3.8640984565284543`*^9, {3.864098509714707*^9, 
   3.8640985405482955`*^9}, {3.8640987659420595`*^9, 3.864098832297591*^9}, {
   3.8640990618782787`*^9, 3.8640990742190466`*^9}, {3.8640991546366377`*^9, 
   3.864099175840083*^9}, 3.8640994459620113`*^9, {3.864099503401514*^9, 
   3.864099509966834*^9}, 3.864099542996378*^9, {3.8640995868043165`*^9, 
   3.864099587236693*^9}, {3.8640996907947025`*^9, 3.8640997207835903`*^9}, {
   3.8640998188401794`*^9, 3.864099826477694*^9}, 3.8641002099724026`*^9, 
   3.864104766076326*^9, 3.864104973302042*^9, {3.864105026969365*^9, 
   3.864105027000616*^9}, {3.8641055279950666`*^9, 3.864105537538396*^9}, 
   3.8641056641727133`*^9, {3.864107586336815*^9, 3.8641075988037148`*^9}, {
   3.86411142841551*^9, 3.8641114394011607`*^9}, {3.8641116479861336`*^9, 
   3.8641116546903315`*^9}, {3.8641118893514524`*^9, 3.864111889398327*^9}, {
   3.8641122054922204`*^9, 3.864112207695646*^9}, 3.8641127231713467`*^9, {
   3.8641129057510085`*^9, 3.864112905813533*^9}, {3.864114895391829*^9, 
   3.8641149748405514`*^9}, {3.864115731031396*^9, 3.8641158063335123`*^9}, {
   3.864118794154196*^9, 3.864118794470748*^9}, {3.8641862870156565`*^9, 
   3.864186287127712*^9}, 3.864190428806219*^9, {3.864262576330483*^9, 
   3.8642626225176735`*^9}, {3.8642626537410145`*^9, 
   3.8642626541286573`*^9}, {3.864262719578656*^9, 3.8642627567833805`*^9}, {
   3.864262874072093*^9, 3.864262928912239*^9}, {3.864262972127731*^9, 
   3.864262979883338*^9}, {3.864263627347845*^9, 3.864263635206918*^9}, {
   3.864263943993925*^9, 3.864263956571619*^9}, {3.864265930777108*^9, 
   3.8642659471750164`*^9}, {3.8642661993934355`*^9, 
   3.8642662305241404`*^9}, {3.864266284263751*^9, 3.8642663005409083`*^9}, {
   3.8642663907626777`*^9, 3.864266453925851*^9}, {3.86426667786413*^9, 
   3.864266707384354*^9}, {3.864266856302696*^9, 3.8642669131765776`*^9}, 
   3.864266957321578*^9, {3.866612705195512*^9, 3.8666127222181745`*^9}, {
   3.866612758731431*^9, 3.866612784459915*^9}, {3.8666303603037734`*^9, 
   3.8666303817542715`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"2ce65aa5-94b7-4e7c-9456-e51bff184849"],

Cell[CellGroupData[{

Cell["Flow and Exact Diagonalisation", "Section",
 CellChangeTimes->{{3.862886941519768*^9, 3.862886958994922*^9}, {
  3.8642629579271903`*^9, 
  3.864262964792833*^9}},ExpressionUUID->"b488f228-9c63-4263-b2e6-\
01f1b82bf4ef"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"L", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"LSpecificDefinitions", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{
    RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<L=\>\"", "<>", 
    RowBox[{"ToString", "[", "L", "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"A0", "=", 
   RowBox[{
    RowBox[{"Import", "[", "\"\<H2_BR.txt\>\"", "]"}], "//", 
    "ToExpression"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"B0", "=", 
   RowBox[{
    RowBox[{"Import", "[", "\"\<H4.txt\>\"", "]"}], "//", "ToExpression"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.86426298734978*^9, 3.86426299854148*^9}, {
   3.864263095065386*^9, 3.864263158176649*^9}, {3.8642631989348707`*^9, 
   3.864263199514346*^9}, {3.864263659814742*^9, 3.864263660431015*^9}, 
   3.8642637188335905`*^9, {3.864263784708125*^9, 3.8642637848174944`*^9}, {
   3.864267345816456*^9, 3.8642673458698387`*^9}, {3.867068773264282*^9, 
   3.867068775786778*^9}, {3.867068820010961*^9, 3.867068833476666*^9}, 
   3.867068894026476*^9},
 CellLabel->"In[47]:=",ExpressionUUID->"204fb95a-84c5-42c3-a34a-38dff0c1a70a"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"tfinal", "=", "60"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"A", ",", "B", ",", "t"}], "]"}], ";", 
  RowBox[{"ClearAll", "[", "Derivative", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sol", "=", 
    RowBox[{"NDSolve", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"A", "'"}], "[", "t", "]"}], "\[Equal]", 
         RowBox[{"dH2", "[", 
          RowBox[{"A", "[", "t", "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"B", "'"}], "[", "t", "]"}], "==", 
         RowBox[{"dH4", "[", 
          RowBox[{
           RowBox[{"A", "[", "t", "]"}], ",", 
           RowBox[{"B", "[", "t", "]"}]}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"A", "[", "0", "]"}], "\[Equal]", "A0"}], ",", 
        RowBox[{
         RowBox[{"B", "[", "0", "]"}], "\[Equal]", "B0"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"A", ",", "B"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "tfinal"}], "}"}]}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A", ",", "B"}], "}"}], "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"A", "[", "tfinal", "]"}], ",", 
       RowBox[{"B", "[", "tfinal", "]"}]}], "}"}], "/.", 
     RowBox[{"sol", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"Style", "[", 
   RowBox[{
   "\"\<With remaining off-diagonal part included:\>\"", ",", "Red", ",", 
    "Bold"}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintSummary", "[", 
   RowBox[{"A0", ",", "B0", ",", "A", ",", "B"}], "]"}], ";", 
  RowBox[{"(*", 
   RowBox[{"Traces", " ", 
    RowBox[{"etc", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Print", "[", 
   RowBox[{"Style", "[", 
    RowBox[{
    "\"\<With remaining off-diagonal part dropped:\>\"", ",", "Red", ",", 
     "Bold"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintSummary", "[", 
   RowBox[{"A0", ",", "B0", ",", 
    RowBox[{
     RowBox[{"DiagonalTensorMask", "[", "2", "]"}], "A"}], ",", 
    RowBox[{
     RowBox[{"DiagonalTensorMask", "[", "4", "]"}], "B"}]}], "]"}], ";", 
  RowBox[{"(*", 
   RowBox[{"Traces", " ", 
    RowBox[{"etc", "."}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"ExactEigenvalues", "=", 
   RowBox[{"Rest", "[", 
    RowBox[{"EigenvaluesPerSector", "[", 
     RowBox[{"A0", ",", "B0"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintEigenvalueTable", "[", 
   RowBox[{"ExactEigenvalues", ",", "\"\<Exact Eigenvalues\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FlowEigenvalues", "=", 
   RowBox[{"Rest", "[", 
    RowBox[{"EigenvaluesPerSector", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"DiagonalTensorMask", "[", "2", "]"}], "A"}], ",", 
      RowBox[{
       RowBox[{"DiagonalTensorMask", "[", "4", "]"}], "B"}]}], "]"}], "]"}]}],
   ";", 
  RowBox[{"(*", 
   RowBox[{"Keep", " ", "only", " ", "diagonal", " ", "part"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"PrintEigenvalueTable", "[", 
   RowBox[{"FlowEigenvalues", ",", "\"\<Flow Eigenvalues\>\""}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintErrorTable", "[", 
   RowBox[{"ExactEigenvalues", ",", "FlowEigenvalues"}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.8628869969571505`*^9, {3.8628871078129225`*^9, 3.8628871482152195`*^9}, {
   3.8628875775565524`*^9, 3.862887614139903*^9}, {3.8628876738247404`*^9, 
   3.8628877258441973`*^9}, 3.862887756500461*^9, {3.862889446540792*^9, 
   3.862889459829661*^9}, {3.8628936210677967`*^9, 3.8628936295702868`*^9}, {
   3.86289377514478*^9, 3.8628938145242767`*^9}, {3.862894712708246*^9, 
   3.862894712824148*^9}, {3.862895270955287*^9, 3.8628952710242968`*^9}, 
   3.8628956207786474`*^9, 3.864098583235591*^9, 3.864099203151355*^9, {
   3.8640993354400063`*^9, 3.8640993842784653`*^9}, {3.86409942399209*^9, 
   3.8640994278547907`*^9}, {3.864099463874791*^9, 3.8640994656641474`*^9}, {
   3.864099769416995*^9, 3.864099769448266*^9}, {3.864099846795314*^9, 
   3.864099847698036*^9}, {3.864100476968992*^9, 3.8641004770067644`*^9}, {
   3.864100516479621*^9, 3.8641005331478395`*^9}, 3.86410105634583*^9, {
   3.8641016864353285`*^9, 3.8641017023387313`*^9}, {3.864102516925006*^9, 
   3.864102517025319*^9}, 3.86410464329967*^9, {3.864104690964083*^9, 
   3.864104703994579*^9}, {3.8641048084782066`*^9, 3.864104820455449*^9}, {
   3.864105040659148*^9, 3.8641050472069883`*^9}, 3.864115818322253*^9, {
   3.8641170073573017`*^9, 3.8641170082010345`*^9}, {3.864263773175706*^9, 
   3.864263773269452*^9}, {3.8642638769036183`*^9, 3.864263885669135*^9}, {
   3.8642665581073155`*^9, 3.8642665660136075`*^9}, {3.864266603260831*^9, 
   3.8642666072567234`*^9}, {3.864267047830316*^9, 3.8642670498044777`*^9}, 
   3.866612811193031*^9, {3.866630393281592*^9, 3.8666304081794057`*^9}, {
   3.8666304603877697`*^9, 3.866630475378197*^9}, {3.8666305067724447`*^9, 
   3.866630568368704*^9}, 3.867069470723276*^9},
 CellLabel->
  "In[105]:=",ExpressionUUID->"f6094525-312f-4836-bfd5-e114537c5cb1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.638433`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{3.866630580935793*^9, 3.8666307001276383`*^9, 
  3.867068856213492*^9, 3.8670694724547253`*^9},
 CellLabel->
  "Out[107]=",ExpressionUUID->"6bb3bb78-d262-42d8-a0df-c23348a882ad"],

Cell[CellGroupData[{

Cell[BoxData[
 StyleBox["\<\"With remaining off-diagonal part included:\"\>",
  StripOnInput->False,
  LineColor->RGBColor[1, 0, 0],
  FrontFaceColor->RGBColor[1, 0, 0],
  BackFaceColor->RGBColor[1, 0, 0],
  GraphicsColor->RGBColor[1, 0, 0],
  FontWeight->Bold,
  FontColor->RGBColor[1, 0, 0]]], "Print",
 CellChangeTimes->{3.866630580945835*^9, 3.8666307001356926`*^9, 
  3.867068856223833*^9, 3.867069472456266*^9},
 CellLabel->
  "During evaluation of \
In[105]:=",ExpressionUUID->"443e4edc-053f-4999-8176-d6f2eea39d1d"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     TemplateBox[{
       StyleBox["\"Off-diagonality: \"", Bold, StripOnInput -> False], 
       RowBox[{"{", 
         RowBox[{"3.250181286699109`*^-7", ",", "4.329497976509038`*^-8"}], 
         "}"}]},
      "RowDefault"]},
    {
     TemplateBox[{
       StyleBox["\"2 Trace: \"", Bold, StripOnInput -> False], 
       RowBox[{"{", 
         RowBox[{"0.3625329231499999`", ",", "0.36253292314999896`", ",", 
           RowBox[{"-", "2.603045159958966`*^-13"}]}], "}"}]},
      "RowDefault"]},
    {
     TemplateBox[{
       StyleBox["\"4 Trace: \"", Bold, StripOnInput -> False], 
       RowBox[{"{", 
         RowBox[{"0.075`", ",", "0.07499999999999998`", ",", 
           RowBox[{"-", "1.8503717077085944`*^-14"}]}], "}"}]},
      "RowDefault"]},
    {
     TemplateBox[{
       StyleBox[
       "\"\\!\\(\\*SuperscriptBox[\\(Trace\\), \\(2\\)]\\): \"", Bold, 
        StripOnInput -> False], 
       RowBox[{"{", 
         RowBox[{
          "2.105988291350153`", ",", "2.1063499493629623`", ",", 
           "0.017172840622848264`"}], "}"}]},
      "RowDefault"]}
   },
   DefaultBaseStyle->"Column",
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Column"]], "Print",
 CellChangeTimes->{3.866630580945835*^9, 3.8666307001356926`*^9, 
  3.867068856223833*^9, 3.867069472471631*^9},
 CellLabel->
  "During evaluation of \
In[105]:=",ExpressionUUID->"32b61e90-897a-492d-b3ef-f203802b8ded"],

Cell[BoxData[
 StyleBox["\<\"With remaining off-diagonal part dropped:\"\>",
  StripOnInput->False,
  LineColor->RGBColor[1, 0, 0],
  FrontFaceColor->RGBColor[1, 0, 0],
  BackFaceColor->RGBColor[1, 0, 0],
  GraphicsColor->RGBColor[1, 0, 0],
  FontWeight->Bold,
  FontColor->RGBColor[1, 0, 0]]], "Print",
 CellChangeTimes->{3.866630580945835*^9, 3.8666307001356926`*^9, 
  3.867068856223833*^9, 3.867069472474114*^9},
 CellLabel->
  "During evaluation of \
In[105]:=",ExpressionUUID->"cb3bc71f-a66e-4d89-82f7-255019a7fdbb"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     TemplateBox[{
       StyleBox["\"Off-diagonality: \"", Bold, StripOnInput -> False], 
       RowBox[{"{", 
         RowBox[{"0.`", ",", "5.863921471162406`*^-55"}], "}"}]},
      "RowDefault"]},
    {
     TemplateBox[{
       StyleBox["\"2 Trace: \"", Bold, StripOnInput -> False], 
       RowBox[{"{", 
         RowBox[{"0.3625329231499999`", ",", "0.36253292314999896`", ",", 
           RowBox[{"-", "2.603045159958966`*^-13"}]}], "}"}]},
      "RowDefault"]},
    {
     TemplateBox[{
       StyleBox["\"4 Trace: \"", Bold, StripOnInput -> False], 
       RowBox[{"{", 
         RowBox[{"0.075`", ",", "0.07499999999999998`", ",", 
           RowBox[{"-", "1.8503717077085944`*^-14"}]}], "}"}]},
      "RowDefault"]},
    {
     TemplateBox[{
       StyleBox[
       "\"\\!\\(\\*SuperscriptBox[\\(Trace\\), \\(2\\)]\\): \"", Bold, 
        StripOnInput -> False], 
       RowBox[{"{", 
         RowBox[{
          "2.105988291350153`", ",", "2.1063499493629436`", ",", 
           "0.01717284062196261`"}], "}"}]},
      "RowDefault"]}
   },
   DefaultBaseStyle->"Column",
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Column"]], "Print",
 CellChangeTimes->{3.866630580945835*^9, 3.8666307001356926`*^9, 
  3.867068856223833*^9, 3.867069472482464*^9},
 CellLabel->
  "During evaluation of \
In[105]:=",ExpressionUUID->"e2445ae4-9345-460d-9af4-e9c1b852ff22"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     StyleBox["\<\"N\"\>",
      StripOnInput->False,
      FontWeight->Bold], 
     StyleBox["\<\"Exact Eigenvalues\"\>",
      StripOnInput->False,
      FontWeight->Bold]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[2.0999999999999996`]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  Function[BoxForm`e$, 
   TableForm[BoxForm`e$]]]], "Print",
 CellChangeTimes->{3.866630580945835*^9, 3.8666307001356926`*^9, 
  3.867068856223833*^9, 3.867069472489235*^9},
 CellLabel->
  "During evaluation of \
In[105]:=",ExpressionUUID->"f82d43f8-4d08-492f-bda7-3e68e6ec1c1d"],

Cell[BoxData[
 InterpretationBox[GridBox[{
    {"1", 
     RowBox[{"-", "1.9359620921255434`"}], 
     RowBox[{"-", "0.3246363389818241`"}], "1.248014561288633`", 
     "1.737649716118734`", "\<\"\"\>", "\<\"\"\>"},
    {"2", 
     RowBox[{"-", "2.201630789506391`"}], 
     RowBox[{"-", "0.6338121058977076`"}], 
     RowBox[{"-", "0.12478294988472141`"}], "0.9706457450159528`", 
     "1.4692088726347228`", "2.995568766538143`"},
    {"3", 
     RowBox[{"-", "0.8516871901821728`"}], 
     RowBox[{"-", "0.3351102830268392`"}], "1.1895716611476679`", 
     "2.7724233509613447`", "\<\"\"\>", "\<\"\"\>"},
    {"4", 
     "1.0250658463`", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", "\<\"\"\
\>"}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[2.0999999999999996`]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  TableForm[{{
    1, -1.9359620921255434`, -0.3246363389818241, 1.248014561288633, 
     1.737649716118734}, {
    2, -2.201630789506391, -0.6338121058977076, -0.12478294988472141`, 
     0.9706457450159528, 1.4692088726347228`, 2.995568766538143}, {
    3, -0.8516871901821728, -0.3351102830268392, 1.1895716611476679`, 
     2.7724233509613447`}, {4, 1.0250658463}}]]], "Print",
 CellChangeTimes->{3.866630580945835*^9, 3.8666307001356926`*^9, 
  3.867068856223833*^9, 3.867069472490363*^9},
 CellLabel->
  "During evaluation of \
In[105]:=",ExpressionUUID->"c9a9d555-8bd3-430b-bc53-ac3d68c79255"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     StyleBox["\<\"N\"\>",
      StripOnInput->False,
      FontWeight->Bold], 
     StyleBox["\<\"Flow Eigenvalues\"\>",
      StripOnInput->False,
      FontWeight->Bold]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[2.0999999999999996`]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  Function[BoxForm`e$, 
   TableForm[BoxForm`e$]]]], "Print",
 CellChangeTimes->{3.866630580945835*^9, 3.8666307001356926`*^9, 
  3.867068856223833*^9, 3.867069472491391*^9},
 CellLabel->
  "During evaluation of \
In[105]:=",ExpressionUUID->"acca087d-79dc-436c-a442-cd09ff735ea0"],

Cell[BoxData[
 InterpretationBox[GridBox[{
    {"1", 
     RowBox[{"-", "1.93596175174357`"}], 
     RowBox[{"-", "0.32463624429212207`"}], "1.2480143871696907`", 
     "1.7376494551659993`", "\<\"\"\>", "\<\"\"\>"},
    {"2", 
     RowBox[{"-", "2.20163040839861`"}], 
     RowBox[{"-", "0.6338118975260398`"}], 
     RowBox[{"-", "0.12478294161709347`"}], "0.9706456996679228`", 
     "1.4692087498542659`", "2.9955683369195474`"},
    {"3", 
     RowBox[{"-", "0.8522129973907253`"}], 
     RowBox[{"-", "0.3342560592917443`"}], "1.1872714071842947`", 
     "2.774395188398169`", "\<\"\"\>", "\<\"\"\>"},
    {"4", 
     "1.0250658462999978`", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", "\
\<\"\"\>"}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[2.0999999999999996`]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  TableForm[{{
    1, -1.93596175174357, -0.32463624429212207`, 1.2480143871696907`, 
     1.7376494551659993`}, {
    2, -2.20163040839861, -0.6338118975260398, -0.12478294161709347`, 
     0.9706456996679228, 1.4692087498542659`, 2.9955683369195474`}, {
    3, -0.8522129973907253, -0.3342560592917443, 1.1872714071842947`, 
     2.774395188398169}, {4, 1.0250658462999978`}}]]], "Print",
 CellChangeTimes->{3.866630580945835*^9, 3.8666307001356926`*^9, 
  3.867068856223833*^9, 3.8670694724923058`*^9},
 CellLabel->
  "During evaluation of \
In[105]:=",ExpressionUUID->"9a70e780-add3-4008-8b9b-7b7b05667f8f"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     StyleBox["\<\"N\"\>",
      StripOnInput->False,
      FontWeight->Bold], 
     StyleBox["\<\"Mean % Error\"\>",
      StripOnInput->False,
      FontWeight->Bold], 
     StyleBox["\<\"Max % Error\"\>",
      StripOnInput->False,
      FontWeight->Bold]},
    {"1", 
     RowBox[{"-", "0.000018929808075844114`"}], 
     RowBox[{"-", "0.00001395167554740827`"}]},
    {"2", 
     RowBox[{"-", "0.000014030408535426901`"}], 
     RowBox[{"-", "4.671944448387537`*^-6"}]},
    {"3", 
     RowBox[{"-", "0.07885403149849116`"}], "0.07112324444029494`"},
    {"4", 
     RowBox[{"-", "2.1661496744478093`*^-13"}], 
     RowBox[{"-", "2.1661496744478093`*^-13"}]}
   },
   AutoDelete->False,
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Grid"]], "Print",
 CellChangeTimes->{3.866630580945835*^9, 3.8666307001356926`*^9, 
  3.867068856223833*^9, 3.8670694724933662`*^9},
 CellLabel->
  "During evaluation of \
In[105]:=",ExpressionUUID->"0f8a42e9-9372-44d6-aac3-93f4d128c4de"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"FlowEigenvalues", ";"}], "\[IndentingNewLine]", 
 RowBox[{"ExactEigenvalues", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"q", "=", 
   RowBox[{
    RowBox[{"#", "&"}], " ", "/@", " ", 
    RowBox[{"Abs", "[", 
     RowBox[{"(", 
      RowBox[{"(", 
       RowBox[{"FlowEigenvalues", "-", "ExactEigenvalues"}], ")"}], ")"}], 
     "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Table", "[", 
  RowBox[{
   RowBox[{
    SuperscriptBox["0.5", "L"], "*", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "[", 
       RowBox[{"[", "j", "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"q", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", "1", ",", 
     RowBox[{"Length", "[", "q", "]"}]}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8644599099399796`*^9, 3.8644599491206303`*^9}, {
  3.864459984469909*^9, 3.8644600521430645`*^9}, {3.864460626598266*^9, 
  3.8644606443832474`*^9}, {3.864460695727145*^9, 3.864460717134869*^9}, {
  3.8644607834395947`*^9, 3.8644607916816483`*^9}, {3.864460875952304*^9, 
  3.864460904519271*^9}, {3.864460959711315*^9, 3.8644609726937137`*^9}, {
  3.86446109937447*^9, 3.864461177638562*^9}, {3.8644672709079323`*^9, 
  3.864467304835119*^9}, {3.8666111894777718`*^9, 3.866611196985635*^9}, {
  3.867069368805563*^9, 3.867069372033434*^9}},
 CellLabel->
  "In[115]:=",ExpressionUUID->"be3f9035-6cd5-4d69-9a03-9a9e6d7e9a82"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "5.438395952669928`*^-8", ",", "7.471838498786243`*^-8", ",", 
   "0.0003532576464902945`", ",", "1.3877787807814457`*^-16"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.867068919280282*^9, 3.867069382802603*^9, 
  3.8670694754675007`*^9},
 CellLabel->
  "Out[118]=",ExpressionUUID->"87c5f0f2-7852-494a-8016-6054075ed107"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Comparison to linear order perturbation theory", "Subsection",
 CellChangeTimes->{{3.864267172586144*^9, 
  3.8642671826604314`*^9}},ExpressionUUID->"348c24d2-241b-4e0a-8be3-\
f2c1900b3735"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"PTEigenvalues", "=", 
   RowBox[{"Rest", "[", 
    RowBox[{"PTEigenvaluesPerSector", "[", 
     RowBox[{"A0", ",", "B0"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintEigenvalueTable", "[", 
   RowBox[{"PTEigenvalues", ",", "\"\<Perturbation Theory Eigenvalues\>\""}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintErrorTable", "[", 
   RowBox[{"ExactEigenvalues", ",", "PTEigenvalues"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.864266943103138*^9, 3.864266995916832*^9}, {
  3.864267041775538*^9, 3.8642670763419704`*^9}, {3.864267159680698*^9, 
  3.86426716145457*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"5764aff8-0390-4832-9e54-5fdcda3980c2"],

Cell[CellGroupData[{

Cell[BoxData[
 TagBox[GridBox[{
    {
     StyleBox["\<\"N\"\>",
      StripOnInput->False,
      FontWeight->Bold], 
     StyleBox["\<\"Perturbation Theory Eigenvalues\"\>",
      StripOnInput->False,
      FontWeight->Bold]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[2.0999999999999996`]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  Function[BoxForm`e$, 
   TableForm[BoxForm`e$]]]], "Print",
 CellChangeTimes->{{3.8642669879473104`*^9, 3.864266996418272*^9}, 
   3.864267032718543*^9, 3.8642670774137373`*^9, 3.8642671639083796`*^9, 
   3.864608175123935*^9},
 CellLabel->
  "During evaluation of \
In[53]:=",ExpressionUUID->"add6ec03-4e8b-4b72-a1e3-1d67b34fc722"],

Cell[BoxData[
 InterpretationBox[GridBox[{
    {"1", 
     RowBox[{"-", "1.0385976267642534`"}], 
     RowBox[{"-", "0.12409961912878616`"}], "0.8978530903849247`", 
     "3.566164728946325`", 
     "3.957429426561788`", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", \
"\<\"\"\>"},
    {"2", 
     RowBox[{"-", "1.152982634474134`"}], 
     RowBox[{"-", "0.0428694278270048`"}], "0.7890215860874228`", 
     "2.5970800422952687`", "2.98556759513243`", "3.456155494828973`", 
     "3.9367761578664062`", "4.518364450400095`", "4.922316268523326`", 
     "7.525570467167214`"},
    {"3", 
     RowBox[{"-", "0.14198632070560102`"}], "2.4967854195968227`", 
     "2.974628937855953`", "3.6471548723013623`", "4.048329545646287`", 
     "4.42362333111403`", "4.9169311146592305`", "6.623221575851047`", 
     "7.519007583483276`", "8.544803940197594`"},
    {"4", "3.5621283644342014`", "4.052659003201097`", "6.626373303586011`", 
     "7.740330157433755`", 
     "8.553509171344936`", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", \
"\<\"\"\>"},
    {"5", 
     "7.75875`", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>", \
"\<\"\"\>", "\<\"\"\>", "\<\"\"\>", "\<\"\"\>"}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[2.0999999999999996`]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  TableForm[{{
    1, -1.0385976267642534`, -0.12409961912878616`, 0.8978530903849247, 
     3.566164728946325, 3.957429426561788}, {
    2, -1.152982634474134, -0.0428694278270048, 0.7890215860874228, 
     2.5970800422952687`, 2.98556759513243, 3.456155494828973, 
     3.9367761578664062`, 4.518364450400095, 4.922316268523326, 
     7.525570467167214}, {
    3, -0.14198632070560102`, 2.4967854195968227`, 2.974628937855953, 
     3.6471548723013623`, 4.048329545646287, 4.42362333111403, 
     4.9169311146592305`, 6.623221575851047, 7.519007583483276, 
     8.544803940197594}, {
    4, 3.5621283644342014`, 4.052659003201097, 6.626373303586011, 
     7.740330157433755, 8.553509171344936}, {5, 7.75875}}]]], "Print",
 CellChangeTimes->{{3.8642669879473104`*^9, 3.864266996418272*^9}, 
   3.864267032718543*^9, 3.8642670774137373`*^9, 3.8642671639083796`*^9, 
   3.864608175129932*^9},
 CellLabel->
  "During evaluation of \
In[53]:=",ExpressionUUID->"5d00bfec-355d-46a5-903f-04357f4ca0b1"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     StyleBox["\<\"N\"\>",
      StripOnInput->False,
      FontWeight->Bold], 
     StyleBox["\<\"Mean % Error\"\>",
      StripOnInput->False,
      FontWeight->Bold], 
     StyleBox["\<\"Max % Error\"\>",
      StripOnInput->False,
      FontWeight->Bold]},
    {"1", "2.1797483600875542`*^-14", "8.551708542481867`*^-14"},
    {"2", 
     RowBox[{"-", "0.1448668833413639`"}], "0.08434737928051478`"},
    {"3", 
     RowBox[{"-", "0.031178880126866454`"}], "0.1035564502993526`"},
    {"4", "0.0024076723954577295`", "0.025350544283494012`"},
    {"5", "0.`", "0.`"}
   },
   AutoDelete->False,
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Grid"]], "Print",
 CellChangeTimes->{{3.8642669879473104`*^9, 3.864266996418272*^9}, 
   3.864267032718543*^9, 3.8642670774137373`*^9, 3.8642671639083796`*^9, 
   3.864608175139925*^9},
 CellLabel->
  "During evaluation of \
In[53]:=",ExpressionUUID->"d00f9c49-76ac-4136-bc09-37dbfcb57375"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"b", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"B", "[", 
       RowBox[{"[", 
        RowBox[{"i", ",", "j", ",", "i", ",", "j"}], "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "L"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", "L"}], "}"}]}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"As", " ", "in", " ", "written", " ", "notes"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalDelta]", "=", 
   RowBox[{
    RowBox[{"-", "2"}], " ", "b"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.864608752754631*^9, 
  3.8646087725857353`*^9}},ExpressionUUID->"16b5d83d-19d5-4ad4-be95-\
c812d81711f4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AFE", "=", 
   RowBox[{
    RowBox[{"Import", "[", "\"\<H2_f.txt\>\"", "]"}], "//", 
    "ToExpression"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BFE", "=", 
   RowBox[{
    RowBox[{"Import", "[", "\"\<H4_f.txt\>\"", "]"}], "//", 
    "ToExpression"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.867069164575638*^9, 3.86706925025349*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"0696ce72-7bda-408a-8b28-8f477812c5d6"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Chop", "[", "AFE", "]"}], "//", 
  "MatrixForm"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Chop", "[", "A", "]"}], "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.8670692219275093`*^9, 3.867069317532748*^9}},
 CellLabel->
  "In[122]:=",ExpressionUUID->"f509998c-e7cc-4fb0-be59-0d6786976a2b"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1.7376497173295755`", "0", "0", "2.237194032`*^-7"},
     {"0", 
      RowBox[{"-", "0.3246363390361601`"}], "0", "0"},
     {"0", "0", 
      RowBox[{"-", "1.9359620921072382`"}], "0"},
     {"2.237194032`*^-7", "0", "0", "1.2480145601683597`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.867069226529896*^9, 3.8670693179269323`*^9}, 
   3.867069491282734*^9},
 CellLabel->
  "Out[122]//MatrixForm=",ExpressionUUID->"a73b6c1f-502a-47d3-b702-\
63b8b580118f"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1.7376494551659993`", "0", "0", "3.250181286699109`*^-7"},
     {"0", 
      RowBox[{"-", "0.32463624429212207`"}], "0", "0"},
     {"0", "0", 
      RowBox[{"-", "1.93596175174357`"}], "0"},
     {"3.250181286699109`*^-7", "0", "0", "1.2480143871696907`"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.867069226529896*^9, 3.8670693179269323`*^9}, 
   3.867069491286915*^9},
 CellLabel->
  "Out[123]//MatrixForm=",ExpressionUUID->"d939bf1f-cf5b-4d85-b1d4-\
9e0892398d14"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Abs", "[", 
   RowBox[{
    RowBox[{"Chop", "[", "AFE", "]"}], "-", 
    RowBox[{"Chop", "[", "A", "]"}]}], "]"}], "//", "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.867069399065157*^9, 3.867069407821906*^9}},
 CellLabel->
  "In[124]:=",ExpressionUUID->"20c90a03-6686-4379-976a-0253657e9008"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"2.621635761812513`*^-7", "0", "0", "1.0129872546991092`*^-7"},
     {"0", "9.474403805942444`*^-8", "0", "0"},
     {"0", "0", "3.403636681387212`*^-7", "0"},
     {"1.0129872546991092`*^-7", "0", "0", "1.7299866894582294`*^-7"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.867069408268876*^9, 3.8670694956171303`*^9},
 CellLabel->
  "Out[124]//MatrixForm=",ExpressionUUID->"c9f42797-d063-4f72-a825-\
4f68215791f0"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{960., 971.25},
WindowMargins->{{0, Automatic}, {Automatic, 51.75}},
Magnification:>1.55 Inherited,
FrontEndVersion->"13.0 for Linux x86 (64-bit) (February 4, 2022)",
StyleDefinitions->"ReverseColor.nb",
ExpressionUUID->"852604fa-9f0f-4c83-95f6-e60f5eedeb34"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 175, 3, 246, "Title",ExpressionUUID->"310d66e1-51a3-4a2e-a121-19f035776462"],
Cell[758, 27, 35544, 936, 4698, "Input",ExpressionUUID->"2ce65aa5-94b7-4e7c-9456-e51bff184849"],
Cell[CellGroupData[{
Cell[36327, 967, 226, 4, 103, "Section",ExpressionUUID->"b488f228-9c63-4263-b2e6-01f1b82bf4ef"],
Cell[36556, 973, 1224, 27, 225, "Input",ExpressionUUID->"204fb95a-84c5-42c3-a34a-38dff0c1a70a"],
Cell[CellGroupData[{
Cell[37805, 1004, 5371, 128, 767, "Input",ExpressionUUID->"f6094525-312f-4836-bfd5-e114537c5cb1"],
Cell[43179, 1134, 282, 6, 71, "Output",ExpressionUUID->"6bb3bb78-d262-42d8-a0df-c23348a882ad"],
Cell[CellGroupData[{
Cell[43486, 1144, 523, 13, 35, "Print",ExpressionUUID->"443e4edc-053f-4999-8176-d6f2eea39d1d"],
Cell[44012, 1159, 1513, 42, 129, "Print",ExpressionUUID->"32b61e90-897a-492d-b3ef-f203802b8ded"],
Cell[45528, 1203, 522, 13, 35, "Print",ExpressionUUID->"cb3bc71f-a66e-4d89-82f7-255019a7fdbb"],
Cell[46053, 1218, 1484, 41, 129, "Print",ExpressionUUID->"e2445ae4-9345-460d-9af4-e9c1b852ff22"],
Cell[47540, 1261, 801, 24, 35, "Print",ExpressionUUID->"f82d43f8-4d08-492f-bda7-3e68e6ec1c1d"],
Cell[48344, 1287, 1611, 38, 104, "Print",ExpressionUUID->"c9a9d555-8bd3-430b-bc53-ac3d68c79255"],
Cell[49958, 1327, 800, 24, 35, "Print",ExpressionUUID->"acca087d-79dc-436c-a442-cd09ff735ea0"],
Cell[50761, 1353, 1628, 38, 104, "Print",ExpressionUUID->"9a70e780-add3-4008-8b9b-7b7b05667f8f"],
Cell[52392, 1393, 1047, 31, 135, "Print",ExpressionUUID->"0f8a42e9-9372-44d6-aac3-93f4d128c4de"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[53488, 1430, 1617, 39, 164, "Input",ExpressionUUID->"be3f9035-6cd5-4d69-9a03-9a9e6d7e9a82"],
Cell[55108, 1471, 363, 9, 74, "Output",ExpressionUUID->"87c5f0f2-7852-494a-8016-6054075ed107"]
}, Open  ]],
Cell[CellGroupData[{
Cell[55508, 1485, 196, 3, 83, "Subsection",ExpressionUUID->"348c24d2-241b-4e0a-8be3-f2c1900b3735"],
Cell[CellGroupData[{
Cell[55729, 1492, 744, 16, 161, "Input",ExpressionUUID->"5764aff8-0390-4832-9e54-5fdcda3980c2"],
Cell[CellGroupData[{
Cell[56498, 1512, 869, 25, 35, "Print",ExpressionUUID->"add6ec03-4e8b-4b72-a1e3-1d67b34fc722"],
Cell[57370, 1539, 2490, 53, 129, "Print",ExpressionUUID->"5d00bfec-355d-46a5-903f-04357f4ca0b1"],
Cell[59863, 1594, 1007, 28, 156, "Print",ExpressionUUID->"d00f9c49-76ac-4136-bc09-37dbfcb57375"]
}, Open  ]]
}, Open  ]],
Cell[60897, 1626, 741, 22, 110, "Input",ExpressionUUID->"16b5d83d-19d5-4ad4-be95-c812d81711f4"],
Cell[61641, 1650, 598, 17, 130, "Input",ExpressionUUID->"0696ce72-7bda-408a-8b28-8f477812c5d6"],
Cell[CellGroupData[{
Cell[62264, 1671, 339, 8, 98, "Input",ExpressionUUID->"f509998c-e7cc-4fb0-be59-0d6786976a2b"],
Cell[62606, 1681, 893, 24, 150, "Output",ExpressionUUID->"a73b6c1f-502a-47d3-b702-63b8b580118f"],
Cell[63502, 1707, 904, 24, 150, "Output",ExpressionUUID->"d939bf1f-cf5b-4d85-b1d4-9e0892398d14"]
}, Open  ]],
Cell[CellGroupData[{
Cell[64443, 1736, 330, 8, 65, "Input",ExpressionUUID->"20c90a03-6686-4379-976a-0253657e9008"],
Cell[64776, 1746, 848, 21, 157, "Output",ExpressionUUID->"c9f42797-d063-4f72-a825-4f68215791f0"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

